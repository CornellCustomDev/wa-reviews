id: off6ek
name: 'HTML element language subtag matches language'
metadata:
    id: off6ek
    name: 'HTML element language subtag matches language'
    rule_type: atomic
    description: "This rule checks that the primary language subtag of an element matches its default language\n"
    accessibility_requirements: { 'wcag20:3.1.2': { forConformance: true, failed: 'not satisfied', passed: satisfied, inapplicable: 'further testing needed' }, 'wcag-technique:H58': { forConformance: false, failed: 'not satisfied', passed: satisfied, inapplicable: satisfied } }
    input_aspects: ['DOM tree', 'Accessibility tree', 'CSS Styling', Language]
    acknowledgments: { authors: ['Jean-Yves Moyen'], funding: [WAI-Tools] }
    htmlHintIgnore: [alt-require]
applicability: "This rule applies to any HTML element with a `lang` attribute for which all the following are true:\n\n- <dfn id=\"off6ek:in-body\">in body</dfn>: the element is an inclusive descendant in the flat tree of a `body` element; and\n- <dfn id=\"off6ek:html\">HTML</dfn>: the element is in a document with a content type of `text/html`; and\n- <dfn id=\"off6ek:valid-lang\">Valid language</dfn>: the element's `lang` attribute value has a known primary language tag; and\n- <dfn id=\"off6ek:not-empty\">Not empty</dfn>: there is some non-empty text inheriting its programmatic language from the element which is neither empty nor only whitespace."
assumptions: "- This rule assumes that user agents and assistive technologies can programmatically determine known primary language tags even on language tags that do not conform to the RFC 5646 syntax.\n\n- This rule assumes that only language tags with a known primary language tag are enough to satisfy Success Criterion 3.1.2 Language of Parts; this notably excludes grandfathered tags and ISO 639.2 three-letters codes, both having poor support in assistive technologies.\n\n- This rule assumes that the text nodes contain text that express something in human language and therefore need a correct programmatic language."
accessibility_support: 'There are no accessibility support issues known.'
background: "This rule checks that, if a `lang` attribute is used, its value is correct with respect to the content. This rule does not check whether a `lang` attribute should have been used or not. Especially, this rule does not check when `lang` attributes are missing. This must be tested separately and it is therefore possible to pass this rule without satisfying [Success Criterion 3.1.2 Language of Parts](https://www.w3.org/TR/WCAG22/#language-of-parts).\n\n### Related rules\n\n- [_Element with `lang` Attribute Has Valid Language Tag_](https://www.w3.org/WAI/standards-guidelines/act/rules/de46e4/)\n\n### Bibliography\n\n- Understanding Success Criterion 3.1.2: Language of Page\n- [H58: Using language attributes to identify changes in the human language](https://www.w3.org/WAI/WCAG22/Techniques/html/H58)\n- [RFC 5646: Tags for Identifying Languages](https://www.rfc-editor.org/rfc/rfc5646.html)\n- [The `lang` and `xml:lang` attributes](https://html.spec.whatwg.org/multipage/dom.html#the-lang-and-xml:lang-attributes)\n\nIn all examples, the `html` element has itself a `lang` attribute in order to make sure that the examples satisfy [Success Criterion 3.1.1 Language of Page](https://www.w3.org/TR/WCAG22/#language-of-page). These `html` elements are, however, never applicable because they are not descendants of a `body` element, and the example descriptions do not mention them further."
test_cases:
    passed: [{ name: 'Passed Example 1', description: 'This `span` element has a `lang` attribute value of `nl` (Dutch), which matches its most common language. The most common language is Dutch because all words are Dutch.', html: "<html lang=\"en\">\n\t<head>\n\t\t<title>Dutch idioms</title>\n\t</head>\n\t<body>\n\t\t<p>\n\t\t\tThe Dutch phrase <span lang=\"nl\">\"Hij ging met de kippen op stok\"</span> literally translates into \"He went to\n\t\t\troost with the chickens\", but it means that he went to bed early.\n\t\t</p>\n\t</body>\n</html>" }, { name: 'Passed Example 2', description: 'The second `p` element has `lang` attribute value of `nl` (Dutch), which matches its most common language. The most common language is Dutch because all English words are in `span` elements with a `lang` attribute value of `en`. Both `span` elements also have a `lang` attribute matching their most common language.', html: "<html lang=\"en\">\n\t<head>\n\t\t<title>Dutch idioms</title>\n\t</head>\n\t<body>\n\t\t<p>Dutch idioms and their English meaning.</p>\n\t\t<p lang=\"nl\">\n\t\t\t<span lang=\"en\">The Dutch phrase</span> \"Hij ging met de kippen op stok\"\n\t\t\t<span lang=\"en\"\n\t\t\t\t>literally translates into \"He went to roost with the chickens\", but it means that he went to bed early.</span\n\t\t\t>\n\t\t</p>\n\t</body>\n</html>" }, { name: 'Passed Example 3', description: 'This `div` element has a `lang` attribute value of `en` (English), which matches its most common language. The most common language is English because the accessible texts are English, and all other text is in a `p` element with a (correct) `lang` attribute value of `fr`.', html: "<html lang=\"FR\">\n\t<head>\n\t\t<title>Feu d'artifice du nouvel an</title>\n\t</head>\n\t<body>\n\t\t<div lang=\"EN\">\n\t\t\t<img src=\"/test-assets/shared/fireworks.jpg\" alt=\"Fireworks over Paris\" />\n\t\t\t<p lang=\"FR\">\n\t\t\t\tBonne année !\n\t\t\t</p>\n\t\t</div>\n\t</body>\n</html>" }, { name: 'Passed Example 4', description: 'This `span` element has a `lang` attribute value of `fr` (French), which matches one of its most common languages. The most common languages are both English and French because all the words belong to both languages.', html: "<html lang=\"en\">\n\t<p>\n\t\tEven though all its words are English and it has meaning in English, the sentence\n\t\t<span lang=\"fr\">Paul put dire comment on tape</span> is also a French sentence.\n\t</p>\n</html>" }, { name: 'Passed Example 5', description: 'This `span` element has a `lang` attribute value of `en` (English), which matches one of its most common languages. The most common languages are both English and French because all the words belong to both languages.', html: "<html lang=\"fr\">\n\t<p>\n\t\tBien que tous les ses mots soient français et qu'elle ait un sens en français, la phrase\n\t\t<span lang=\"en\">Paul put dire comment on tape</span> est aussi une phrase anglaise.\n\t</p>\n</html>" }]
    failed: [{ name: 'Failed Example 1', description: 'This `span` element has `lang` attribute value of `fr` (French), which does not match its most common language. The most common language is Dutch because all words are Dutch.', html: "<html lang=\"en\">\n\t<head>\n\t\t<title>Dutch idioms</title>\n\t</head>\n\t<body>\n\t\t<p>\n\t\t\tThe Dutch phrase <span lang=\"fr\">\"Hij ging met de kippen op stok\"</span> literally translates into \"He went to\n\t\t\troost with the chickens\", but it means that he went to bed early.\n\t\t</p>\n\t</body>\n</html>" }, { name: 'Failed Example 2', description: 'The second `p` element has `lang` attribute value of `en` (English), which does not match its most common language. The most common language is Dutch because all English words are in `span` elements with a `lang` attribute value of `fr`. Both `span` elements also have an incorrect `lang` attribute in order to make sure that all targets in this example fail the rule.', html: "<html lang=\"nl\">\n\t<head>\n\t\t<title>Met de kippen op stok</title>\n\t</head>\n\t<body>\n\t\t<blockquote>\n\t\t\t<p>\"Hij ging met de kippen op stok\"</p>\n\t\t</blockquote>\n\t\t<p lang=\"en\">\n\t\t\t<span lang=\"fr\">The Dutch phrase</span> \"Hij ging met de kippen op stok\"\n\t\t\t<span lang=\"fr\"\n\t\t\t\t>literally translates into \"He went to roost with the chickens\", but it means that he went to bed early.</span\n\t\t\t>\n\t\t</p>\n\t</body>\n</html>" }, { name: 'Failed Example 3', description: "This `div` element has a `lang` attribute value of `fr` (French), which does not match its most common language. The most common language is English because the accessible texts are English, and all other text is in a `p` element with a `lang` attribute value of `nl`, which also doesn't match its common language.", html: "<html lang=\"fr\">\n\t<head>\n\t\t<title>Feu d'artifice du nouvel an</title>\n\t</head>\n\t<body>\n\t\t<div lang=\"fr\">\n\t\t\t<img src=\"/test-assets/shared/fireworks.jpg\" alt=\"Fireworks over Paris\" />\n\t\t\t<p lang=\"nl\">\n\t\t\t\tBonne année !\n\t\t\t</p>\n\t\t</div>\n\t</body>\n</html>" }, { name: 'Failed Example 4', description: 'This `div` element has a `lang` attribute value of `fr` (French), which does not match its most common language. The most common language is English because the accessible name of the `img` element is English. The `lang` attribute on the `p` element is effectively ignored. The `p` element is not applicable because there is no text inheriting its programmatic language from it since its content is neither visible nor included in the accessibility tree.', html: "<html lang=\"fr\">\n\t<head>\n\t\t<title>Feu d'artifice du nouvel an</title>\n\t</head>\n\t<body>\n\t\t<div lang=\"fr\">\n\t\t\t<img src=\"/test-assets/shared/fireworks.jpg\" aria-labelledby=\"caption\" />\n\t\t\t<p lang=\"en\" id=\"caption\" hidden>\n\t\t\t\tFireworks over Paris\n\t\t\t</p>\n\t\t</div>\n\t</body>\n</html>" }]
    inapplicable: [{ name: 'Inapplicable Example 1', description: "This document is not [HTML](#off6ek:html).\n\n```svg\n<svg xmlns=\"http://www.w3.org/2000/svg\" lang=\"en\">\n    <text x=\"0\" y=\"0\">I love ACT rules!</text>\n</svg>\n```\n\n#### Inapplicable Example 2\n\nThere is no [descendant of a `body`](#off6ek:in-body) element with a `lang` attribute.", html: "<html lang=\"en\">\n\t<body>\n\t\t<p>I love ACT rules!</p>\n\t</body>\n</html>" }, { name: 'Inapplicable Example 3', description: 'The first `p` element is empty](#off6ek:not-empty) because the only [element inheriting its programmatic language is itself, and it has no text node child.', html: "<html lang=\"en\">\n\t<body>\n\t\t<p lang=\"fr\"></p>\n\t\t<p>I love ACT rules!</p>\n\t</body>\n</html>" }, { name: 'Inapplicable Example 4', description: 'This `p` element is empty](#off6ek:not-empty) because it has no content that is either [visible or included in the accessibility tree.', html: "<html lang=\"en\">\n\t<body>\n\t\t<p lang=\"fr\" hidden>I love ACT rules!</p>\n\t</body>\n</html>" }, { name: 'Inapplicable Example 5', description: 'The text inheriting its programmatic language from this `div` element is only whitespace.', html: "<html lang=\"en\">\n\t<body>\n\t\t<div lang=\"invalid\">&nbsp;</div>\n\t</body>\n</html>" }]
expectation: 'For each test target, the primary language of its `lang` attribute value is a most common language of the test target.'
